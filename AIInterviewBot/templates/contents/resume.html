{% extends "base.html" %}
{% block title %}簡歷{% endblock %}
{% block content %}
{% load static %}

<div class="container" style="margin-top:10px">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <form id="resumeForm" method="post">
                {% csrf_token %}
                <div class="contents-title">
                    個人簡歷輸入
                </div>
                <div class="contents-test">
                    <label>➊{{ form.personal_education.label }}</label>
                    {{ form.personal_education }}
                </div>
                <div class="contents-test">
                    <label>➋{{ form.personal_experience.label }}</label>
                    {{ form.personal_experience }}
                </div>
                <div class="contents-test">
                    <label>➌{{ form.skill.label }}</label>
                    {{ form.skill }}
                </div>
                <div class="contents-test">
                    <label>➍{{ form.interest.label }}</label>
                    {{ form.interest }}
                </div>
                <div class="contents-test">
                    <label>➎{{ form.style.label }}</label>
                    {{ form.style }}
                </div>
                <div class="d-grid col-10 mx-auto">
                    <input type="submit" id="generate-btn" class="btn btn-primary" value="生成個人簡歷" />
                    <button id="load-btn" class="btn btn-primary" type="button" disabled style="display: none">
                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="vertical-align: baseline;"></span>
                        生成中...
                    </button>
                    <button id="download-btn" class="btn btn-secondary" type="button" style="display: none">
                        <img src="{% static 'images/download.png' %}" alt="download" style="width: 35px; height: 35px; vertical-align: top;">
                        下載簡歷
                    </button>
                </div>
            </form>
            <form id="download-form" action="{% url 'DownloadFile' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="file_name"/>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#resumeForm').submit(function (e) {
            e.preventDefault();
            // 隱藏生成按鈕
            $('#generate-btn').hide();
            // 顯示生成中按鈕
            $('#load-btn').show();
            $.ajax({
                url: '{% url "Resume" %}',
                type: 'POST',
                data: $(this).serialize(),
                success: function (data) {
                    // 隱藏生成中按鈕
                    $('#load-btn').hide();
                    // 所有輸入欄位改成禁用
                    $('#id_personal_education, #id_personal_experience, #id_skill, #id_interest, #id_style').prop('disabled', true);
                    // 設定檔名到隱藏欄位
                    $('#download-form input[name=file_name]').val(data.file_name);
                    // 顯示下載按鈕
                    $('#download-btn').show();
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
        $('#download-btn').click(function (e) {
            $('#download-form').submit();
        });
    });
</script>

{% endblock %}